C251 COMPILER V5.60.0,  main                                                               18/07/24  11:09:05  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Out_File\main.obj
COMPILER INVOKED BY: D:\keil5\keil5_MDK\keil5_MDK_32\C251\BIN\C251.EXE ..\USER\src\main.c XSMALL INTR2 WARNINGLEVEL(3) B
                    -ROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..
                    -\USER\inc;..\USER\src) DEBUG PRINT(.\Out_File\main.lst) OBJECT(.\Out_File\main.obj) 

stmt  level    source

    1          #include "headfile.h"
    2          #include "Motor.h"
    3          #include "ADC.h"
    4          #include "MPU6050.h"
    5          #include "Element.h"
    6          #include "ADC.h"
    7          #include "math.h"
    8          #include "TOF.h"
    9          #include "Buzzer.h"
   10          #include "Key.h"
   11          #include "ui.h"
   12          #include "isr.h"
   13          
   14          #define FILTER_N 8
   15          
   16          float Dis_Process = 0;
   17          float Adjust_Val = 0;
   18          char KeyValue = 0;      
   19          
   20          void Init_all(void);
   21          void Get_Ratio(void);
   22          void Speed_Gain(void);
   23          
   24          uint16 Filter_Window(uint16 Dis) 
   25          {
   26   1          static uint16 filter_buf[FILTER_N + 1];
   27   1          int i;    
   28   1          uint16 filter_sum = 0;
   29   1          filter_buf[FILTER_N] = Dis;
   30   1          for(i = 0; i < FILTER_N; i++) 
   31   1          {
   32   2              filter_buf[i] = filter_buf[i + 1]; // ÊâÄÊúâÊï∞ÊçÆÂ∑¶ÁßªÔºå‰Ωé‰Ωç‰ªçÊéâ
   33   2              filter_sum += filter_buf[i];
   34   2          }
   35   1          return (uint16)(filter_sum / FILTER_N);
   36   1      }
   37          
   38          void main(void)   
   39          {
   40   1              Init_all();
   41   1              EnableGlobalIRQ();      
   42   1              Adjust_Val = 0;
   43   1              while(1)
   44   1              {       
   45   2                      //printf("%.2f,%.2f,%.2f,%.2f,%.2f,%.2f\r\n",Exp_Speed_gain ,Circle_Flag1,Circle_Flag2,ADC_proc[2],Rati
             -o,Dis_Process);
   46   2              printf("%.2f,%.2f,%.2f,%.2f,%.2f,%.2f\r\n",Act_PwmL ,Act_PwmR,Exp_Speed_L,Exp_Speed_R,Speed_L,Spe
             -ed_R); 
   47   2      /******************************************** ÊåâÈîÆËØªÂÄº***********************************************
             -***********************/       
   48   2                      
   49   2              ui_show();
   50   2                      KeyValue = GetKey_Value(0);
   51   2                      if              (KeyValue == KEY2_PRES)         {page++; if(page >= 3)  page = 3;oled_all_static_state();}              
   52   2                      else if (KeyValue == KEY3_PRES)         {page--; if(page <= 0)  page = 0;oled_all_static_state();}                      
   53   2                      else if (KeyValue == KEY0_PRES)         Adjust_Val += 1;
   54   2                      else if (KeyValue == KEY1_PRES)         Adjust_Val -= 1;
C251 COMPILER V5.60.0,  main                                                               18/07/24  11:09:05  PAGE 2   

   55   2              
   56   2      /******************************************** Á±ª‰ºº‰∏≠Êñ≠ÊúçÂä°Â§ÑÁêÜ **********************************
             -****************************/ 
   57   2                      if(Isr_Flag_10 == 1)
   58   2                      {
   59   3                              MPU6050_Refresh_DMP();                          //ËØªÂèñËßíÂ∫¶ÂÄº
   60   3                              MPU_Get_Gyroscope(&gx, &gy, &gz);       //ËØªÂèñËßíÈÄüÂ∫¶
   61   3                  if(vl53l0x_finsh_flag == 1)         //‰∏ÄÊ¨°ÊµãË∑ùÊúâÊïà
   62   3                  {
   63   4                      Dis_Process = Filter_Window(vl53l0x_distance_mm);
   64   4                  }
   65   3                  Speed_Gain();
   66   3      /************************************************ ‰∏ä‰∏ãÂù°ÈÅì ******************************************
             -**/
   67   3                  Elem_Up_Down(Pitch);
   68   3      //############Â¶ÇÊûú‰∏ãÂù°ËøûÁùÄÊÄ•ÂºØ###########Âè™ËÉΩÊ≥®Èáä‰∏çÂèØÂà†Èô§
   69   3      //            if(Down_Flag>0)
   70   3      //            {
   71   3      //                Down_Flag--;
   72   3      //                Exp_Speed = 100;
   73   3      //            }
   74   3      //            else
   75   3      //                Down_Flag=0;
   76   3      
   77   3      /************************************************ Â§ßÂºØ‰∏¢Á∫ø ******************************************
             -**/                 
   78   3                  if(Flag_Out_L == 1 && (--Edge_Delay) > 0 )   //-- Edge_Delay ‰øùËØÅÊ∏ÖÈõ∂Êó∂‰∏ç‰ºöÂÜçËøõÂà§Êñ
             -≠
   79   3                  {
   80   4                      //x10_ms = 10;
   81   4                      Exp_Speed = 150;
   82   4                      Ratio = 0.2+(Speed_R/120)*0.15; 
   83   4                  }
   84   3                  else if(Flag_Out_R == 1 && (--Edge_Delay) > 0)
   85   3                  {
   86   4                      //x10_ms = 10;
   87   4                      Exp_Speed = 150;
   88   4                      Ratio = -0.2-(Speed_L/120)*0.15;        
   89   4                  }
   90   3                  else
   91   3                      Edge_Delay = 0; 
   92   3                  
   93   3                  Isr_Flag_10 = 0;
   94   3              }
   95   2              }               
   96   1      }
   97          
   98          void Speed_Gain(void)
   99          {
  100   1          int i = 0;
  101   1          static float Speed_Buf[6] = {0,0};
  102   1          Speed_Buf[5] = (Speed_L+Speed_R)/2;     //ÂèñËΩ¶ÁöÑÂπ≥ÂùáÈÄüÂ∫¶
  103   1          for(i ; i < 5; i++) 
  104   1          {
  105   2              Speed_Buf[i] = Speed_Buf[i + 1]; // ÊâÄÊúâÊï∞ÊçÆÂ∑¶ÁßªÔºå‰Ωé‰Ωç‰ªçÊéâ
  106   2              Sum_Dis += Speed_Buf[i];
  107   2          }
  108   1          if(Sum_Dis <= SUM_THRESHOLD)    // 5Ê¨°‰πãÂÜÖÁßØÂàÜÂÄºÈ´ò‰∫éSUM_THRESHOLDÂàôÊòØÁõ¥Á∫ø
  109   1          {
  110   2              Sum_Dis = 0;
  111   2              Exp_Speed_gain = 0.8;
  112   2          }
  113   1          else
  114   1          {
  115   2              Sum_Dis = 0;
  116   2              Exp_Speed_gain = 1.0;
C251 COMPILER V5.60.0,  main                                                               18/07/24  11:09:05  PAGE 3   

  117   2          }
  118   1      }
  119          
  120          
  121          
  122          void Init_all(void)
  123          {
  124   1              WTST = 0;                                                
  125   1              DisableGlobalIRQ();                             
  126   1              sys_clk = 35000000;                             
  127   1              board_init();                                   
  128   1      
  129   1      ////ÁºñÁ†ÅÂô®ÊñπÂêëÂºïËÑöÂàùÂßãÂåñ
  130   1              gpio_mode(P5_3, GPIO);          
  131   1              gpio_mode(P3_5, GPIO);  
  132   1              
  133   1      ////ÊåâÈîÆÂºïËÑöÂàùÂßãÂåñ
  134   1              Key_Init();
  135   1              
  136   1      ////ÊµãË∑ùÊ®°ÂùóÂàùÂßãÂåñ
  137   1          vl53l0x_init();
  138   1          
  139   1      ////OLEDÂàùÂßãÂåñ
  140   1              ui_init();                                      
  141   1              
  142   1      ////MPU6050ÂàùÂßãÂåñ
  143   1              MPU6050_DMP_Init();     
  144   1      //      
  145   1      ////ÂÆöÊó∂Âô®ÂàùÂßãÂåñ
  146   1              pit_timer_ms(TIM_4, 10);                //10msÂÆöÊó∂Âô®
  147   1      //      
  148   1      ////ÁºñÁ†ÅÂô®ÂàùÂßãÂåñ
  149   1              ctimer_count_init(CTIM0_P34);   //ÁºñÁ†ÅÂô®1ËÆ°Êï∞
  150   1              ctimer_count_init(CTIM3_P04);   //ÁºñÁ†ÅÂô®2ËÆ°Êï∞
  151   1              
  152   1      ////ÁîµÊú∫ÂàùÂßãÂåñ
  153   1              Motor_Init();
  154   1              
  155   1      ////ËúÇÈ∏£Âô®ÂàùÂßãÂåñ
  156   1               Buzzer_Init();
  157   1              
  158   1      ////ÂàùÂßãÂåñÊâÄÊúâADÂºïËÑö
  159   1              ADC_InitAll(); 
  160   1              
  161   1          ////pidÂàùÂßãÂåñ  PID_Init(ÁªìÊûÑ‰Ωì, KPa,Kpb, KI, KD, ËæìÂá∫ÈôêÂπÖÔºåÁßØÂàÜÈôêÂπÖ)
  162   1              PID_Init(&Turn_PID , 0,-2, 0, 0 ,10000, 0);
  163   1              
  164   1          // PID_Incremental_Init(PID_Incremental *pid, float Kp, float Ki, float Kd,float Out_Limit, float Int
             -egral_Limit,uint8 use_lowpass_filter)
  165   1          PID_Incremental_Init(&Left_Wheel ,58,3.9,0.1,9000,3000,1);//48
  166   1          PID_Incremental_Init(&Right_Wheel,58,3.9,0.1,9000,3000,1);//48
  167   1          
  168   1      //    PID_Incremental_Init(&Left_Wheel ,58,3.9,0.1,9000,3000,1);//48
  169   1      //    PID_Incremental_Init(&Right_Wheel,58,3.9,0.1,9000,3000,1);//48
  170   1              
  171   1      } 


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       845     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
C251 COMPILER V5.60.0,  main                                                               18/07/24  11:09:05  PAGE 4   

  edata size           =        51     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        81     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
